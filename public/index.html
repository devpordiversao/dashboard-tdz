<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDZ Bot Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg,#161620,#1e1e2e); color: #fff; padding:20px; }
        .navbar { background: #2a2a3e; padding: 20px; border-radius: 10px; margin-bottom:20px; display:flex; justify-content: space-between; align-items:center; }
        h1 { color: #5865F2; }
        .card { background: #2a2a3e; padding: 20px; border-radius: 10px; margin-bottom:20px; }
        .tabs { display: flex; gap:10px; margin-bottom:20px; border-bottom: 2px solid #444; }
        .tab { padding:10px 20px; cursor:pointer; border-bottom:3px solid transparent; }
        .tab.active { color:#5865F2; border-bottom-color:#5865F2; }
        .tab-content { display:none; }
        .tab-content.active { display:block; }
        input, textarea, select { width:100%; padding:10px; margin:10px 0; background:#161620; border:2px solid #444; border-radius:5px; color:#fff; }
        .btn { padding:10px 20px; margin:5px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
        .btn-primary { background:#5865F2; color:white; }
        .btn-success { background:#43B581; color:white; }
        .btn-danger { background:#F04747; color:white; }
        .logs { background:#000; padding:15px; border-radius:5px; max-height:300px; overflow-y:auto; font-family: monospace; }
        .log-entry { padding:5px 0; }
        .info { color:#43B581; }
        .error { color:#F04747; }
        .warning { color:#FAA61A; }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>ü§ñ TDZ Bot Dashboard</h1>
        <div>Status: <span id="status">Offline</span></div>
    </div>

    <div class="card">
        <h2>Servidores: <span id="serverCount">0</span></h2>
        <select id="serverSelect"></select>
        <div id="serversList"></div>
    </div>

    <div class="card">
        <div class="tabs">
            <div class="tab active" onclick="showTab('messages')">üì® Mensagens</div>
            <div class="tab" onclick="showTab('channels')">üìÅ Canais</div>
            <div class="tab" onclick="showTab('roles')">üé≠ Cargos</div>
            <div class="tab" onclick="showTab('commands')">‚ö° Comandos</div>
        </div>

        <!-- Mensagens -->
        <div class="tab-content active" id="messages">
            <!-- Campo existente -->
            <label>Canal:</label>
            <select id="channelSelect"></select>
            <label>Mensagem:</label>
            <textarea id="messageText" rows="4" placeholder="Digite sua mensagem"></textarea>
            <button class="btn btn-primary" onclick="sendMessage()">üì® Enviar</button>

            <hr style="margin:20px 0; border-color:#444;">

            <!-- Novo campo para DM -->
            <label>Enviar DM para usu√°rio:</label>
            <select id="dmUserSelect"></select>
            <label>Mensagem DM:</label>
            <textarea id="dmMessageText" rows="4" placeholder="Digite a mensagem DM"></textarea>
            <button class="btn btn-primary" onclick="sendDM()">‚úâÔ∏è Enviar DM</button>
        </div>

        <!-- Canais -->
        <div class="tab-content" id="channels">
            <label>Nome do Canal:</label>
            <input type="text" id="channelName" placeholder="Nome do canal">
            <label>Tipo:</label>
            <select id="channelType">
                <option>Texto</option>
                <option>Voz</option>
            </select>
            <button class="btn btn-primary" onclick="createChannel()">‚ûï Criar Canal</button>
        </div>

        <!-- Cargos -->
        <div class="tab-content" id="roles">
            <label>Usu√°rio:</label>
            <select id="userSelect"></select>
            <label>Cargo:</label>
            <select id="roleSelect"></select>
            <button class="btn btn-success" onclick="giveRole()">‚ûï Dar Cargo</button>
            <button class="btn btn-danger" onclick="removeRole()">‚ûñ Remover</button>
        </div>

        <!-- Comandos -->
        <div class="tab-content" id="commands">
            <button class="btn btn-success" onclick="startBot()">‚ñ∂Ô∏è Iniciar</button>
            <button class="btn btn-danger" onclick="stopBot()">‚èπÔ∏è Parar</button>
        </div>
    </div>

    <div class="card">
        <h2>üìã Logs <button class="btn btn-danger" onclick="clearLogs()">Limpar</button></h2>
        <div class="logs" id="logs"></div>
    </div>

    <script>
        function showTab(tab){
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function addLog(type,msg){
            const log = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = 'log-entry '+type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLogs(){ document.getElementById('logs').innerHTML=''; }

        async function loadServers(){
            const res = await fetch('/api/servers');
            const servers = await res.json();
            const sel = document.getElementById('serverSelect');
            sel.innerHTML = '';
            servers.forEach(s=>{
                const opt = document.createElement('option');
                opt.value = s.id;
                opt.textContent = s.name;
                sel.appendChild(opt);
            });
            loadChannels();
            loadUsers();
            loadRoles();
            loadDMUsers();
        }

        async function loadChannels(){
            const guildId = document.getElementById('serverSelect').value;
            const res = await fetch(`/api/servers/${guildId}/channels`);
            const channels = await res.json();
            const sel = document.getElementById('channelSelect');
            sel.innerHTML='';
            channels.forEach(c=>{
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = c.name;
                sel.appendChild(opt);
            });
        }

        async function loadUsers(){
            const guildId = document.getElementById('serverSelect').value;
            const res = await fetch(`/api/servers/${guildId}/members`);
            const users = await res.json();
            const sel = document.getElementById('userSelect');
            sel.innerHTML='';
            users.forEach(u=>{
                const opt = document.createElement('option');
                opt.value = u.id;
                opt.textContent = u.tag;
                sel.appendChild(opt);
            });
        }

        async function loadRoles(){
            const guildId = document.getElementById('serverSelect').value;
            const res = await fetch(`/api/servers/${guildId}/roles`);
            const roles = await res.json();
            const sel = document.getElementById('roleSelect');
            sel.innerHTML='';
            roles.forEach(r=>{
                const opt = document.createElement('option');
                opt.value = r.id;
                opt.textContent = r.name;
                sel.appendChild(opt);
            });
        }

        // Novo: dropdown para DM
        async function loadDMUsers(){
            const guildId = document.getElementById('serverSelect').value;
            const res = await fetch(`/api/servers/${guildId}/members`);
            const users = await res.json();
            const sel = document.getElementById('dmUserSelect');
            sel.innerHTML='';
            users.forEach(u=>{
                const opt = document.createElement('option');
                opt.value = u.id;
                opt.textContent = u.tag;
                sel.appendChild(opt);
            });
        }

        document.getElementById('serverSelect').addEventListener('change', ()=>{
            loadChannels();
            loadUsers();
            loadRoles();
            loadDMUsers();
        });

        async function sendMessage(){
            const guildId = document.getElementById('serverSelect').value;
            const channelId = document.getElementById('channelSelect').value;
            const message = document.getElementById('messageText').value;
            if(!message) return addLog('warning','Mensagem vazia');
            try{
                const res = await fetch('/api/send-message',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({guildId,channelId,message})
                });
                if(res.ok) addLog('info',`Mensagem enviada no canal ${channelId}`);
                else addLog('error',`Falha ao enviar mensagem: ${await res.text()}`);
            } catch(err){ addLog('error',`Erro ao enviar mensagem: ${err.message}`); }
        }

        async function sendDM(){
            const guildId = document.getElementById('serverSelect').value;
            const userId = document.getElementById('dmUserSelect').value;
            const message = document.getElementById('dmMessageText').value;
            if(!message) return addLog('warning','Mensagem DM vazia');
            try{
                const res = await fetch('/api/send-dm',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({guildId,userId,message})
                });
                if(res.ok) addLog('info',`Mensagem DM enviada para ${userId}`);
                else addLog('error',`Falha ao enviar DM: ${await res.text()}`);
            } catch(err){ addLog('error',`Erro ao enviar DM: ${err.message}`); }
        }

        async function createChannel(){
            const guildId = document.getElementById('serverSelect').value;
            const name = document.getElementById('channelName').value;
            const type = document.getElementById('channelType').value;
            if(!name) return addLog('warning','Nome do canal vazio');
            try{
                const res = await fetch('/api/create-channel',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({guildId,name,type})
                });
                if(res.ok){
                    const data = await res.json();
                    addLog('info',`Canal ${data.name} criado com sucesso`);
                    loadChannels();
                } else addLog('error',`Falha ao criar canal: ${await res.text()}`);
            } catch(err){ addLog('error',`Erro ao criar canal: ${err.message}`); }
        }

        async function giveRole(){
            const guildId = document.getElementById('serverSelect').value;
            const userId = document.getElementById('userSelect').value;
            const roleId = document.getElementById('roleSelect').value;
            try{
                const res = await fetch('/api/set-role',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({guildId,userId,roleId})
                });
                if(res.ok) addLog('info','Cargo adicionado');
                else addLog('error',`Falha ao adicionar cargo: ${await res.text()}`);
            } catch(err){ addLog('error',`Erro ao adicionar cargo: ${err.message}`); }
        }

        async function removeRole(){
            const guildId = document.getElementById('serverSelect').value;
            const userId = document.getElementById('userSelect').value;
            const roleId = document.getElementById('roleSelect').value;
            try{
                const res = await fetch('/api/remove-role',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({guildId,userId,roleId})
                });
                if(res.ok) addLog('info','Cargo removido');
                else addLog('error',`Falha ao remover cargo: ${await res.text()}`);
            } catch(err){ addLog('error',`Erro ao remover cargo: ${err.message}`); }
        }

        function startBot(){ document.getElementById('status').textContent='Online'; addLog('info','Bot iniciado'); }
        function stopBot(){ document.getElementById('status').textContent='Offline'; addLog('error','Bot parado'); }

        // Inicializa tudo
        loadServers();
        addLog('info','Dashboard pronto');
    </script>
</body>
                </html>

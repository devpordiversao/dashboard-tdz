<!-- public/index.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDZ Bot Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>ðŸ¤– TDZ Bot Dashboard</h1>

<div class="dashboard-section">
    <h2>Servidor / Canal / Mensagem</h2>
    <select id="serverSelect"></select>
    <select id="channelSelect"></select>
    <textarea id="messageInput" placeholder="Digite sua mensagem"></textarea>
    <button onclick="sendMessage()">Enviar Mensagem</button>
</div>

<div class="dashboard-section">
    <h2>UsuÃ¡rio / Cargo</h2>
    <select id="userSelect"></select>
    <input id="roleInput" placeholder="ID do cargo">
    <button onclick="setRole()">Dar Cargo</button>
</div>

<div class="dashboard-section">
    <h2>Logs</h2>
    <div id="logBox" style="background:#000;padding:1rem;height:300px;overflow-y:auto;color:#0f0;font-family:monospace;"></div>
</div>

<script>
// Carregar servidores, canais, membros
async function loadServers() {
    const res = await fetch('/api/servers');
    const servers = await res.json();
    const serverSelect = document.getElementById('serverSelect');
    serverSelect.innerHTML='';
    servers.forEach(s=>{const opt=document.createElement('option');opt.value=s.id;opt.textContent=s.name;serverSelect.appendChild(opt)});
    loadChannels();
}
async function loadChannels() {
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/channels`);
    const channels=await res.json();
    const channelSelect=document.getElementById('channelSelect');
    channelSelect.innerHTML='';
    channels.forEach(c=>{const opt=document.createElement('option');opt.value=c.id;opt.textContent=c.name;channelSelect.appendChild(opt)});
    loadMembers();
}
async function loadMembers() {
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/members`);
    const members=await res.json();
    const userSelect=document.getElementById('userSelect');
    userSelect.innerHTML='';
    members.forEach(u=>{const opt=document.createElement('option');opt.value=u.id;opt.textContent=u.tag;userSelect.appendChild(opt)});
}

document.getElementById('serverSelect').addEventListener('change',()=>{loadChannels()});
loadServers();

// FunÃ§Ãµes de aÃ§Ã£o
async function sendMessage() {
    const guildId=document.getElementById('serverSelect').value;
    const channelId=document.getElementById('channelSelect').value;
    const message=document.getElementById('messageInput').value;
    await fetch('/api/send-message',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,channelId,message})});
    updateLogs();
}
async function setRole() {
    const guildId=document.getElementById('serverSelect').value;
    const userId=document.getElementById('userSelect').value;
    const roleId=document.getElementById('roleInput').value;
    await fetch('/api/set-role',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,userId,roleId})});
    updateLogs();
}

// Atualizar logs
async function updateLogs() {
    const res = await fetch('/api/logs');
    const logs = await res.json();
    const logBox = document.getElementById('logBox');
    logBox.innerHTML = logs.map(l => `<div>${l}</div>`).join('');
}
setInterval(updateLogs, 2000);
</script>
</body>
</html>

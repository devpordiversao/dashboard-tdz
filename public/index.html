<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDZ Bot Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#1e1e2e;color:#fff;min-height:100vh;padding:2rem}
h1,h2{margin-bottom:1rem}
.dashboard-section{background:#2a2a3e;padding:1.5rem;border-radius:12px;margin-bottom:2rem;box-shadow:0 4px 20px rgba(0,0,0,0.2)}
input,select,textarea{width:100%;padding:.75rem;margin-bottom:.5rem;border-radius:8px;border:2px solid rgba(255,255,255,.1);background:#161620;color:#fff}
textarea{resize:vertical;min-height:80px}
button{padding:.75rem 1.5rem;margin-top:.5rem;border:none;border-radius:8px;background:#5865F2;color:#fff;font-weight:600;cursor:pointer;transition:.3s}
button:hover{transform:scale(1.05);box-shadow:0 5px 20px rgba(88,101,242,.4)}
#logBox{background:#000;padding:1rem;height:300px;overflow-y:auto;color:#0f0;font-family:monospace;border-radius:8px}
small{color:#B9BBBE}
</style>
</head>
<body>

<h1>ü§ñ TDZ Bot Dashboard</h1>

<!-- SERVIDORES -->
<div class="dashboard-section">
<h2>Servidor / Canal / Mensagem</h2>
<label>Servidor</label>
<select id="serverSelect"></select>
<label>Canal</label>
<select id="channelSelect"></select>
<label>Mensagem</label>
<textarea id="messageInput" placeholder="Digite sua mensagem"></textarea>
<button onclick="sendMessage()">Enviar Mensagem</button>
</div>

<!-- USU√ÅRIO / CARGO -->
<div class="dashboard-section">
<h2>Usu√°rio / Cargo</h2>

<label>Usu√°rio</label>
<input id="userInput" placeholder="Digite o nome ou tag do usu√°rio">
<select id="userSelect"></select>
<small>Escolha pelo dropdown ou digite manualmente</small>

<label>Cargo</label>
<input id="roleInput" placeholder="Digite o ID ou nome do cargo">
<select id="roleSelect"></select>
<small>Escolha pelo dropdown ou digite manualmente</small>

<button onclick="setRole()">Dar Cargo</button>
</div>

<!-- LOGS -->
<div class="dashboard-section">
<h2>Logs</h2>
<div id="logBox"></div>
</div>

<script>
// CARREGAR SERVIDORES
async function loadServers() {
    const res = await fetch('/api/servers');
    const servers = await res.json();
    const serverSelect = document.getElementById('serverSelect');
    serverSelect.innerHTML='';
    servers.forEach(s=>{
        const opt=document.createElement('option');
        opt.value=s.id;
        opt.textContent=s.name;
        serverSelect.appendChild(opt)
    });
    loadChannels();
}
async function loadChannels() {
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/channels`);
    const channels=await res.json();
    const channelSelect=document.getElementById('channelSelect');
    channelSelect.innerHTML='';
    channels.forEach(c=>{
        const opt=document.createElement('option');
        opt.value=c.id;
        opt.textContent=c.name;
        channelSelect.appendChild(opt)
    });
    loadMembers();
    loadRoles();
}
async function loadMembers() {
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/members`);
    const members=await res.json();
    const userSelect=document.getElementById('userSelect');
    userSelect.innerHTML='';
    members.forEach(u=>{
        const opt=document.createElement('option');
        opt.value=u.id;
        opt.textContent=u.tag;
        userSelect.appendChild(opt)
    });
}
async function loadRoles() {
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/roles`);
    const roles=await res.json();
    const roleSelect=document.getElementById('roleSelect');
    roleSelect.innerHTML='';
    roles.forEach(r=>{
        const opt=document.createElement('option');
        opt.value=r.id;
        opt.textContent=r.name;
        roleSelect.appendChild(opt)
    });
}

// EVENTO QUANDO SERVIDOR MUDA
document.getElementById('serverSelect').addEventListener('change',()=>{loadChannels()})
loadServers();

// FUN√á√ïES DE A√á√ÉO
async function sendMessage(){
    const guildId=document.getElementById('serverSelect').value;
    const channelId=document.getElementById('channelSelect').value;
    const message=document.getElementById('messageInput').value;
    await fetch('/api/send-message',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({guildId,channelId,message})
    });
    updateLogs();
}
async function setRole(){
    const guildId=document.getElementById('serverSelect').value;
    const userId=document.getElementById('userInput').value || document.getElementById('userSelect').value;
    const roleId=document.getElementById('roleInput').value || document.getElementById('roleSelect').value;
    await fetch('/api/set-role',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({guildId,userId,roleId})
    });
    updateLogs();
}

// LOGS EM TEMPO REAL
async function updateLogs(){
    const res=await fetch('/api/logs');
    const logs=await res.json();
    const logBox=document.getElementById('logBox');
    logBox.innerHTML=logs.map(l=>`<div>${l}</div>`).join('');
}
setInterval(updateLogs,2000);
</script>

</body>
</html>

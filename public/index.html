<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDZ Bot Dashboard</title>
<style>
body{font-family:sans-serif;background:#1e1e2e;color:#fff;padding:1rem}
select,input,textarea,button{display:block;margin:0.5rem 0;padding:0.5rem;border-radius:5px;border:none;font-size:1rem;width:100%}
button{cursor:pointer}
</style>
</head>
<body>
<h1>TDZ Dashboard</h1>

<label>Servidor</label>
<select id="serverSelect"></select>

<label>Canal</label>
<select id="channelSelect"></select>

<label>Mensagem</label>
<textarea id="messageInput" placeholder="Digite sua mensagem"></textarea>
<button onclick="sendMessage()">Enviar Mensagem</button>

<hr>

<label>Usuário</label>
<select id="userSelect"></select>

<label>Cargo (ID)</label>
<input id="roleInput" placeholder="Coloque o ID do cargo">
<button onclick="setRole()">Dar Cargo</button>

<script>
// Carrega servidores, canais e membros
async function loadServers(){
    const res = await fetch('/api/servers');
    const servers = await res.json();
    const serverSelect = document.getElementById('serverSelect');
    serverSelect.innerHTML='';
    servers.forEach(s=>{const opt=document.createElement('option');opt.value=s.id;opt.textContent=s.name;serverSelect.appendChild(opt)});
    loadChannels();
}
async function loadChannels(){
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/channels`);
    const channels=await res.json();
    const channelSelect=document.getElementById('channelSelect');
    channelSelect.innerHTML='';
    channels.forEach(c=>{const opt=document.createElement('option');opt.value=c.id;opt.textContent=c.name;channelSelect.appendChild(opt)});
    loadMembers();
}
async function loadMembers(){
    const serverId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${serverId}/members`);
    const members=await res.json();
    const userSelect=document.getElementById('userSelect');
    userSelect.innerHTML='';
    members.forEach(u=>{const opt=document.createElement('option');opt.value=u.id;opt.textContent=u.tag;userSelect.appendChild(opt)});
}
document.getElementById('serverSelect').addEventListener('change',()=>{loadChannels()});
loadServers();

// Funções de ação
async function sendMessage(){
    const guildId=document.getElementById('serverSelect').value;
    const channelId=document.getElementById('channelSelect').value;
    const message=document.getElementById('messageInput').value;
    await fetch('/api/send-message',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,channelId,message})});
    alert('Mensagem enviada!');
}
async function setRole(){
    const guildId=document.getElementById('serverSelect').value;
    const userId=document.getElementById('userSelect').value;
    const roleId=document.getElementById('roleInput').value;
    await fetch('/api/set-role',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,userId,roleId})});
    alert('Cargo adicionado!');
}
</script>
</body>
</html>

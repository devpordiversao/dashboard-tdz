<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDZ Bot Dashboard</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:Arial,sans-serif; background:linear-gradient(135deg,#161620,#1e1e2e); color:#fff; padding:20px; }
.navbar { background:#2a2a3e; padding:20px; border-radius:10px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center; }
h1 { color:#5865F2; }
.card { background:#2a2a3e; padding:20px; border-radius:10px; margin-bottom:20px; }
.tabs { display:flex; gap:10px; margin-bottom:20px; border-bottom:2px solid #444; }
.tab { padding:10px 20px; cursor:pointer; border-bottom:3px solid transparent; }
.tab.active { color:#5865F2; border-bottom-color:#5865F2; }
.tab-content { display:none; }
.tab-content.active { display:block; }
input, textarea, select { width:100%; padding:10px; margin:10px 0; background:#161620; border:2px solid #444; border-radius:5px; color:#fff; }
.btn { padding:10px 20px; margin:5px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
.btn-primary { background:#5865F2; color:white; }
.btn-success { background:#43B581; color:white; }
.btn-danger { background:#F04747; color:white; }
.logs { background:#000; padding:15px; border-radius:5px; max-height:300px; overflow-y:auto; font-family:monospace; }
.log-entry { padding:5px 0; }
.info { color:#43B581; }
.error { color:#F04747; }
.warning { color:#FAA61A; }
</style>
</head>
<body>

<!-- Servidor invis√≠vel -->
<select id="serverSelect" style="display:none;"></select>

<div class="navbar">
<h1>ü§ñ TDZ Bot Dashboard</h1>
<div>Status: <span id="status">Offline</span></div>
</div>

<div class="card">
<h2>Servidores: <span id="serverCount">0</span></h2>
<div id="serversList"></div>
</div>

<div class="card">
<div class="tabs">
<div class="tab active" onclick="showTab('messages')">üì® Mensagens</div>
<div class="tab" onclick="showTab('channels')">üìÅ Canais</div>
<div class="tab" onclick="showTab('roles')">üé≠ Cargos</div>
<div class="tab" onclick="showTab('commands')">‚ö° Comandos</div>
</div>

<!-- Mensagens -->
<div class="tab-content active" id="messages">
<label>Canal:</label>
<select id="channelSelect"></select>
<textarea id="messageText" rows="4" placeholder="Digite sua mensagem"></textarea>
<button class="btn btn-primary" onclick="sendMessage()">üì® Enviar</button>
</div>

<!-- Canais -->
<div class="tab-content" id="channels">
<label>Nome do Canal:</label>
<input type="text" id="channelName">
<label>Tipo:</label>
<select id="channelType"><option>Texto</option><option>Voz</option></select>
<button class="btn btn-primary" onclick="createChannel()">‚ûï Criar Canal</button>
</div>

<!-- Cargos -->
<div class="tab-content" id="roles">
<label>Usu√°rio:</label>
<input id="userInput" placeholder="Digite o nome ou tag do usu√°rio">
<select id="userSelect"></select>
<small>Digite ou selecione do dropdown</small>

<label>Cargo:</label>
<input id="roleInput" placeholder="Digite o ID ou nome do cargo">
<select id="roleSelect"></select>
<small>Digite ou selecione do dropdown</small>

<button class="btn btn-success" onclick="giveRole()">‚ûï Dar Cargo</button>
<button class="btn btn-danger" onclick="removeRole()">‚ûñ Remover</button>
</div>

<!-- Comandos -->
<div class="tab-content" id="commands">
<button class="btn btn-success" onclick="startBot()">‚ñ∂Ô∏è Iniciar</button>
<button class="btn btn-danger" onclick="stopBot()">‚èπÔ∏è Parar</button>
</div>
</div>

<!-- Logs -->
<div class="card">
<h2>üìã Logs <button class="btn btn-danger" onclick="clearLogs()">Limpar</button></h2>
<div class="logs" id="logs"></div>
</div>

<script>
function showTab(tab){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(tab).classList.add('active');
}

// --- Fun√ß√µes da Claude ---
function addLog(type,msg){
    const log=document.getElementById('logs');
    const entry=document.createElement('div');
    entry.className='log-entry '+type;
    entry.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;
    log.appendChild(entry);
    log.scrollTop=log.scrollHeight;
}
function updateBotStatus(status){ document.getElementById('status').textContent=status; }
function addServer(id,name,icon,memberCount){
    const list=document.getElementById('serversList');
    const div=document.createElement('div');
    div.textContent=`${name} (${memberCount} membros)`;
    div.style.cursor='pointer';
    div.onclick=()=>{ document.getElementById('serverSelect').value=id; loadChannels(); loadMembers(); loadRoles(); addLog('info',`Servidor ${name} selecionado`) };
    list.appendChild(div);
}
function addCommand(name,time){ addLog('info',`Comando ${name} executado em ${time}`); }

// --- Nosso JS funcional ---
async function loadServers(){
    const res=await fetch('/api/servers');
    const servers=await res.json();
    const serverSelect=document.getElementById('serverSelect');
    serverSelect.innerHTML='';
    document.getElementById('serversList').innerHTML='';
    document.getElementById('serverCount').textContent=servers.length;
    servers.forEach(s=>{
        const opt=document.createElement('option');
        opt.value=s.id;
        opt.textContent=s.name;
        serverSelect.appendChild(opt);
        addServer(s.id,s.name,s.icon,s.memberCount);
    });
    serverSelect.value=servers[0]?.id;
    loadChannels();
    loadMembers();
    loadRoles();
}

async function loadChannels(){
    const guildId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${guildId}/channels`);
    const channels=await res.json();
    const channelSelect=document.getElementById('channelSelect');
    channelSelect.innerHTML='';
    channels.forEach(c=>{
        const opt=document.createElement('option');
        opt.value=c.id;
        opt.textContent=c.name;
        channelSelect.appendChild(opt);
    });
}

async function loadMembers(){
    const guildId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${guildId}/members`);
    const members=await res.json();
    const userSelect=document.getElementById('userSelect');
    userSelect.innerHTML='';
    members.forEach(m=>{
        const opt=document.createElement('option');
        opt.value=m.id;
        opt.textContent=m.tag;
        userSelect.appendChild(opt);
    });
}

async function loadRoles(){
    const guildId=document.getElementById('serverSelect').value;
    const res=await fetch(`/api/servers/${guildId}/roles`);
    const roles=await res.json();
    const roleSelect=document.getElementById('roleSelect');
    roleSelect.innerHTML='';
    roles.forEach(r=>{
        const opt=document.createElement('option');
        opt.value=r.id;
        opt.textContent=r.name;
        roleSelect.appendChild(opt);
    });
}

// A√ß√µes
async function sendMessage(){
    const guildId=document.getElementById('serverSelect').value;
    const channelId=document.getElementById('channelSelect').value;
    const message=document.getElementById('messageText').value;
    await fetch('/api/send-message',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,channelId,message})});
    addLog('info',`Mensagem enviada no canal ${channelId}`);
}

async function createChannel(){
    const guildId=document.getElementById('serverSelect').value;
    const name=document.getElementById('channelName').value;
    const type=document.getElementById('channelType').value;
    await fetch('/api/create-channel',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,name,type})});
    addLog('info',`Canal ${name} criado`);
    loadChannels();
}

async function giveRole(){
    const guildId=document.getElementById('serverSelect').value;
    const userId=document.getElementById('userInput').value||document.getElementById('userSelect').value;
    const roleId=document.getElementById('roleInput').value||document.getElementById('roleSelect').value;
    await fetch('/api/set-role',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,userId,roleId})});
    addLog('info',`Cargo ${roleId} dado a usu√°rio ${userId}`);
    loadRoles();
}

async function removeRole(){
    const guildId=document.getElementById('serverSelect').value;
    const userId=document.getElementById('userInput').value||document.getElementById('userSelect').value;
    const roleId=document.getElementById('roleInput').value||document.getElementById('roleSelect').value;
    await fetch('/api/remove-role',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({guildId,userId,roleId})});
    addLog('warning',`Cargo ${roleId} removido de usu√°rio ${userId}`);
    loadRoles();
}

async function startBot(){ await fetch('/api/bot-start',{method:'POST'}); updateBotStatus('Online'); addLog('info','Bot iniciado'); }
async function stopBot(){ await fetch('/api/bot-stop',{method:'POST'}); updateBotStatus('Offline'); addLog('error','Bot parado'); }
function clearLogs(){ document.getElementById('logs').innerHTML=''; }

// Inicializa√ß√£o
addLog('info','Dashboard pronto');
loadServers();
</script>
</body>
</html>

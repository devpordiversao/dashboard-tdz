<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDZ Bot Dashboard</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #161620, #1e1e2e); color: #fff; padding: 20px; }
.navbar { background: #2a2a3e; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
h1 { color: #5865F2; }
.card { background: #2a2a3e; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
.tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #444; }
.tab { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; }
.tab.active { color: #5865F2; border-bottom-color: #5865F2; }
.tab-content { display: none; }
.tab-content.active { display: block; }
input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; background: #161620; border: 2px solid #444; border-radius: 5px; color: #fff; }
.btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
.btn-primary { background: #5865F2; color: white; }
.btn-success { background: #43B581; color: white; }
.btn-danger { background: #F04747; color: white; }
.logs { background: #000; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; font-family: monospace; }
.log-entry { padding: 5px 0; }
.info { color: #43B581; }
.error { color: #F04747; }
.warning { color: #FAA61A; }
</style>
</head>
<body>
<div class="navbar">
<h1>ü§ñ TDZ Bot Dashboard</h1>
<div>Status: <span id="status">Offline</span></div>
</div>

<div class="card">
<h2>Servidores: <span id="serverCount">0</span></h2>
<div id="serversList"></div>
</div>

<div class="card">
<div class="tabs">
<div class="tab active" onclick="showTab('messages')">üì® Mensagens</div>
<div class="tab" onclick="showTab('channels')">üìÅ Canais</div>
<div class="tab" onclick="showTab('roles')">üé≠ Cargos</div>
<div class="tab" onclick="showTab('commands')">‚ö° Comandos</div>
</div>

<div class="tab-content active" id="messages">
<label>Canal:</label>
<select id="channelSelect"></select>
<label>Mensagem:</label>
<textarea id="messageText" rows="4"></textarea>
<button class="btn btn-primary" onclick="sendMessage()">üì® Enviar</button>
</div>

<div class="tab-content" id="channels">
<label>Nome do Canal:</label>
<input type="text" id="channelName">
<label>Tipo:</label>
<select id="channelType">
<option>Texto</option>
<option>Voz</option>
</select>
<button class="btn btn-primary" onclick="createChannel()">‚ûï Criar Canal</button>
</div>

<div class="tab-content" id="roles">
<label>Usu√°rio:</label>
<select id="userSelect"></select>
<label>Cargo:</label>
<select id="roleSelect"></select>
<button class="btn btn-success" onclick="giveRole()">‚ûï Dar Cargo</button>
<button class="btn btn-danger" onclick="removeRole()">‚ûñ Remover</button>
</div>

<div class="tab-content" id="commands">
<button class="btn btn-success" onclick="startBot()">‚ñ∂Ô∏è Iniciar</button>
<button class="btn btn-danger" onclick="stopBot()">‚èπÔ∏è Parar</button>
</div>
</div>

<div class="card">
<h2>üìã Logs <button class="btn btn-danger" onclick="clearLogs()">Limpar</button></h2>
<div class="logs" id="logs"></div>
</div>

<script>
function showTab(tab) {
document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
event.target.classList.add('active');
document.getElementById(tab).classList.add('active');
}

function addLog(type, msg) {
const log = document.getElementById('logs');
const entry = document.createElement('div');
entry.className = 'log-entry ' + type;
entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
log.appendChild(entry);
log.scrollTop = log.scrollHeight;
}

function clearLogs() {
document.getElementById('logs').innerHTML = '';
}

// -------------------- FUN√á√ïES DE DROPDOWN --------------------
async function populateDropdowns() {
try {
    const resUsers = await fetch('/api/users');
    const users = await resUsers.json();
    const userSelect = document.getElementById('userSelect');
    userSelect.innerHTML = '';
    users.forEach(u => {
        const option = document.createElement('option');
        option.value = u.id;
        option.textContent = u.username;
        userSelect.appendChild(option);
    });

    const resRoles = await fetch('/api/roles');
    const roles = await resRoles.json();
    const roleSelect = document.getElementById('roleSelect');
    roleSelect.innerHTML = '';
    roles.forEach(r => {
        const option = document.createElement('option');
        option.value = r.id;
        option.textContent = r.name;
        roleSelect.appendChild(option);
    });

    const resChannels = await fetch('/api/channels');
    const channels = await resChannels.json();
    const channelSelect = document.getElementById('channelSelect');
    channelSelect.innerHTML = '';
    channels.forEach(c => {
        const option = document.createElement('option');
        option.value = c.id;
        option.textContent = c.name;
        channelSelect.appendChild(option);
    });

} catch(err) {
    addLog('error', 'Erro ao popular dropdowns: ' + err);
}

// Atualiza a cada 10s
setTimeout(populateDropdowns, 10000);
}

// -------------------- A√á√ïES --------------------
async function sendMessage() {
const channelId = document.getElementById('channelSelect').value;
const message = document.getElementById('messageText').value;
try {
    const res = await fetch('/api/send-message', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ channelId, message })
    });
    const data = await res.json();
    addLog('info', `Mensagem enviada: ${data.message}`);
} catch(err) {
    addLog('error', 'Erro ao enviar mensagem: ' + err);
}
}

async function createChannel() {
const name = document.getElementById('channelName').value;
const type = document.getElementById('channelType').value;
const guildId = document.getElementById('serverSelect')?.value; // opcional se s√≥ 1 servidor
try {
    const res = await fetch('/api/create-channel', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ guildId, name, type })
    });
    const data = await res.json();
    addLog('info', `Canal "${data.name}" criado!`);
} catch(err) {
    addLog('error', 'Falha ao criar canal: ' + err);
}
}

async function giveRole() {
const userId = document.getElementById('userSelect').value;
const roleId = document.getElementById('roleSelect').value;
try {
    const res = await fetch('/api/give-role', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ userId, roleId })
    });
    const data = await res.json();
    addLog('info', data.message);
} catch(err) {
    addLog('error', 'Erro ao adicionar cargo: ' + err);
}

}

async function removeRole() {
const userId = document.getElementById('userSelect').value;
const roleId = document.getElementById('roleSelect').value;
try {
    const res = await fetch('/api/remove-role', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ userId, roleId })
    });
    const data = await res.json();
    addLog('info', data.message);
} catch(err) {
    addLog('error', 'Erro ao remover cargo: ' + err);
}

// -------------------- BOT --------------------
function startBot() {
document.getElementById('status').textContent = 'Online';
addLog('info', 'Bot iniciado');
populateDropdowns();
}

function stopBot() {
document.getElementById('status').textContent = 'Offline';
addLog('error', 'Bot parado');
}

// Inicializa
addLog('info', 'Dashboard pronto');
populateDropdowns();
</script>
</body>
</html>
